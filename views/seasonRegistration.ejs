<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/GLOSLogo.png">
    <title>Season Registration</title>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Poppins", Sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        .container {

        display: flex;

        justify-content: center;

        align-items: center;

        }
        #registerButton {
            background-color: #ceff00;
            font-size: 3vh;
            border-width: medium;
            border-color: black;
            font-weight: 500;
            border-style: solid;
            color: black;
            padding: 5px 40px 5px 40px;
        }
        input:focus, textarea:focus, select:focus {
            outline: 2px solid #ceff00; /* Change to your preferred color */
        }
        ::selection {
            background: #ceff00; 
            color: #121212; 
        }
        
        /* input::selection, textarea::selection {
            background: #ceff00;
            color: #121212;
        } */

    </style>
</head>
<body style="text-align: center; width: 100%;" >
    <div style="background-image: linear-gradient(180deg, #CEFF00 0%, #4E6100 100%); width: 100%;">
         <img height="200vh" src="/GLOSLogo.png" alt="GLOS Logo" id="mainLogo">
        <h1 style="color: #f4f4f4;"><%= data.season.seasonName %> Registration</h1>
    </div>
   
    
    <form id="individualSeasonRegistrationForm" action="/api/payments/individualSeasonCheckoutSession" method="post">
        <input type="hidden" name="seasonId" id="" value="<%= data.seasonId%>">
        <input type="text" name="firstName" placeholder="First Name" value="<%= data.userAttributes.firstName ? data.userAttributes.firstName : ''  %>" required>
        <input type="text" name="lastName" placeholder="Last Name" value="<%= data.userAttributes.lastName ? data.userAttributes.lastName : ''  %>" required>
        <br>
        <br>
        <input type="email" name="email" placeholder="Email" value="<%= data.userAttributes.email ? data.userAttributes.email : ''  %>" required>
        <input type="tel" name="phone" placeholder="Phone Number" value="<%= data.userAttributes.phone ? data.userAttributes.phone : ''  %>" required>
        <br>
        <br>
        <label for="dob">Date of Birth:</label>
        <% console.log(data.userAttributes.dob) %>
        <input type="date" name="dob" value="<%= (data.userAttributes.dob && data.userAttributes.dob !== '' && data.userAttributes.dob !== 0) ? new Date(Number(data.userAttributes.dob)).toISOString().slice(0, 10) : '' %>" required>
        <br>
        <br>
        <label for="gender">Gender:</label>
        <br>

        <input type="radio" name="gender" id="gender_male" value="male" <%=data.userAttributes.gender && data.userAttributes.gender.toLowerCase() === 'male' ? 'checked' : ''  %> required><label for="gender_male">Male</label>
        <br>
        <input type="radio" name="gender" id="gender_female" value="female" <%= data.userAttributes.gender && data.userAttributes.gender.toLowerCase() === 'female' ? 'checked' : ''  %>><label for="gender_female">Female</label>
        <br>
        <input type="radio" name="gender" id="gender_unspecified" value="unspecified" <%= (!data.userAttributes.gender || (data.userAttributes.gender.toLowerCase() !== 'male' && data.userAttributes.gender.toLowerCase() !== 'female')) ? 'checked' : ''  %>><label for="gender_unspecified">Unspecified</label>
        <br>
        <br>
        <label for="skill">Rate your Skill Level:</label>
        <select name="skill" id="" required>
            <option value="1" <%= data.userAttributes.skill == '1' ? 'selected' : ''  %>>1 - What's a soccer ball?</option>
            <option value="2" <%= data.userAttributes.skill == '2' ? 'selected' : ''  %>>2 - Running is overrated</option>
            <option value="3" <%= !['1', '2', '4', '5', 1, 2, 4, 5].includes(data.userAttributes.skill) ? 'selected' : ''  %>>3 - I used to play back in the day</option>
            <option value="4" <%= data.userAttributes.skill == '4' ? 'selected' : ''  %>>4 - I play regularly</option>
            <option value="5" <%= data.userAttributes.skill == '5' ? 'selected' : ''  %>>5 - I live for soccer</option>
        </select>
        <br><br>
        <label for="discounted">Are you a student, teacher, first responder, or member of the military?:</label>
        <br>
        <br>
        
        <input type="radio" name="discounted" id="discounted_yes" value="1" <%= data.userAttributes.discounted && data.userAttributes.discounted === 1 ? 'checked' : ''  %> required><label for="discounted_yes">Yes</label>
        <br>
        <input type="radio" name="discounted" id="discounted_no" value="0" <%= !data.userAttributes.discounted || data.userAttributes.discounted !== 1 ? 'checked' : ''  %>><label for="discounted_no">No</label>
        <br>
        <br>
        <label for="">Leagues & Teams:</label>
        <br>
        <br>
        <% for(let league of data.leagues){ %>
            <input type="checkbox" name="leagueId_<%= league.leagueId %>" id="leagueId_<%= league.leagueId %>"><label for="leagueId_<%= league.leagueId %>"><%= league.shortName %></label>
            <select name="<%=league.leagueId %>_teamId" id="">
                <option value="FA">Free Agent</option>
                <% for(let team of league.teams) { %>
                    <option value="<%= team.id %>"><%= team.shortName %></option>
                <% } %>
            </select>
        <br>
        <% } %>
        <% if (data.leaguesAlreadyRegistered.length !== 0) { %>
            <br>
            <label for="">Already Registered:</label>
            <br><br>
            <% for(let league of data.leaguesAlreadyRegistered){ %>
                <input type="text" disabled value="<%= league.leagueShortName %>">
                <input type="text" disabled value="<%= league.teamShortName %>">
                <br>
            <% } %>
            
        <% } %>
        <br>
        <label for="">Shirt Size: </label>
        <select name="shirtSize" id="" required>
            <option value="S" <%= data.userAttributes.shirtSize === 'S' ? 'selected' : ''  %>>Small</option>
            <option value="M" <%= data.userAttributes.shirtSize === 'M' ? 'selected' : ''  %>>Medium</option>
            <option value="L" <%= !['S', 'M', 'XL', 'XXL'].includes(data.userAttributes.shirtSize) ? 'selected' : ''  %>>Large</option>
            <option value="XL" <%= data.userAttributes.shirtSize === 'XL' ? 'selected' : ''  %>>X-Large</option>
            <option value="XXL" <%= data.userAttributes.shirtSize === 'XXL' ? 'selected' : ''  %>>XX-Large</option>
        </select>
        <br>
        <br>
        <label for="">Emergency Contact:</label>
        <br>
        <br>
        <input type="text" name="emergencyContactFirstName" placeholder="First Name" value="<%= data.userAttributes.emergencyContactFirstName ? data.userAttributes.emergencyContactFirstName : ''  %>" required>
        <input type="text" name="emergencyContactLastName" placeholder="Last Name" value="<%= data.userAttributes.emergencyContactLastName ? data.userAttributes.emergencyContactLastName : ''  %>" required>
        <br>
        <br>

        <input type="tel" name="emergencyContactPhone" placeholder="Phone Number" value="<%= data.userAttributes.emergencyContactPhone ? data.userAttributes.emergencyContactPhone : ''  %>" required>

        <input type="text" name="emergencyContactRelationship" placeholder="Relationship" value="<%= data.userAttributes.emergencyContactRelationship ? data.userAttributes.emergencyContactRelationship : ''  %>" required>
        <br>
        <br>
        <label for="">Do you have any allergies or medical conditions we should be aware of?</label>
        <br>
        <br>

        <div class="container">
            <div class="section">
                <h3>Allergies</h3>
                <div id="allergy-list">
                    <% for(let allergy of data.userAttributes.allergies){ %>
                        <% if(allergy !== ''){ %>
                            <br>
                            <input type="text" class="allergy-input" name="allergies[]" value="<%= allergy %>" placeholder="Enter an allergy">
                        <% } %>
                    <% } %>
                    <br>
                    <input type="text" class="allergy-input" name="allergies[]" placeholder="Enter an allergy">
                </div>
            </div>
            <div class="section">
                <h3>Medical Conditions</h3>
                <div id="medical-list">
                    <% for(let condition of data.userAttributes.medicalConditions){ %>
                        <% if(condition !== ''){ %>
                            <br>
                            <input type="text" class="medical-input" name="medicalConditions[]" value="<%= condition %>" placeholder="Enter a medical condition">
                        <% } %>
                    <% } %>
                    <br>
                    <input type="text" class="medical-input" name="medicalConditions[]" placeholder="Enter a medical condition">
                </div>
            </div>
        </div>

        <!-- <input type="text" name="medicalConditions" placeholder="List Medical Conditions"> -->
        <br><br>
        <a target="_blank" href="https://envoroot.com/player-resources/waiver/">Waiver</a>
        <br><br>
        <input type="checkbox" name="waiver" id="waiver" required><label for="waiver" >I have read and agree to the terms of the wavier.</label>
        <br>
        <br>
        <button style="background-color: #ceff00;" id="registerButton">Register</button>
    </form>
    <script>
        document.addEventListener("input", function(event) {
        if (event.target.classList.contains("allergy-input")) {
            handleDynamicInputs("allergy-list", "allergy-input", "allergies[]", "Enter an allergy");
        } else if (event.target.classList.contains("medical-input")) {
            handleDynamicInputs("medical-list", "medical-input", "medicalConditions[]", "Enter a medical condition");
        }
    });

    function handleDynamicInputs(listId, inputClass, inputName, placeholderText) {
        let list = document.getElementById(listId);
        let inputs = list.querySelectorAll(`.${inputClass}`);
        
        // Count blank inputs
        let blankInputs = Array.from(inputs).filter(input => input.value.trim() === "");
        
        // If more than one blank input, remove the last one
        if (blankInputs.length > 1) {
            list.removeChild(blankInputs[blankInputs.length - 1].previousSibling); // Remove <br>
            list.removeChild(blankInputs[blankInputs.length - 1]); // Remove input
            return;
        }

        // If the last input has a value, add a new one
        let lastInput = inputs[inputs.length - 1];
        if (lastInput.value.trim() !== "") {
            let newBr = document.createElement("br");
            let newInput = document.createElement("input");
            newInput.type = "text";
            newInput.name = inputName;
            newInput.placeholder = placeholderText;
            newInput.classList.add(inputClass);

            list.appendChild(newBr);
            list.appendChild(newInput);
        }
    }
  
document.querySelectorAll('input[type="tel"]').forEach(input => {
  input.addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, ""); // Remove non-digits
    if (value.length > 3) value = value.replace(/^(\d{3})/, "$1-");
    if (value.length > 6) value = value.replace(/^(\d{3})-(\d{3})/, "$1-$2-");
    e.target.value = value.slice(0, 12); // Max: XXX-XXX-XXXX
  });
});
document.getElementById('individualSeasonRegistrationForm').addEventListener('submit', function(event) {
    // Check if at least one checkbox is selected
    const checkboxes = document.querySelectorAll('input[name^="leagueId"]:checked');
    
    if (checkboxes.length === 0) {
      alert('Please select at least one league!');
      event.preventDefault(); // Prevent form submission
    }
    handleSubmit(this,event)
  });
  function handleSubmit(form,event) {
            // if (!validateCheckboxes(form)) {
            //     return false; 
            // }
            paymentSubmit(form,event, 'individualSeasonCheckoutSession')
        }
//   async function handlePlayerRegistrationSubmit(form, event) {
//     let formData = new FormData(form)
//     console.log(formData);
//     await fetch('registration', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/x-www-form-urlencoded',
//         },
//         body: new URLSearchParams(formData).toString(),
//     });

//     }
    </script>
    <script src="/main.js"></script>
</body>
</html>
